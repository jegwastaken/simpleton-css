/// Utility to clear floats
@mixin clearfix() {
    &:before,
    &:after {
        display:table;
        clear:both;
        width:100%;
        content:'';
    }
}

/// Converts `$aspect-width` and `$aspect-height` to the appropriate bottom padding.
/// @param {<number>} $aspect-width [16]
/// @param {<number>} $aspect-height [9]
/// @access private
@mixin aspect-ratio-to-padding($aspect-width:16, $aspect-height:9) {
    padding-bottom:percentage($aspect-height / $aspect-width);
}

/// Adds styles for a responsive video container.
/// @param {<number>} $aspect-width [16]
/// @param {<number>} $aspect-height [9]
@mixin video-container($aspect-width:16, $aspect-height:9) {
    @include aspect-ratio-to-padding($aspect-width, $aspect-height);

    position:relative;
    display:block;
    height:0;

    iframe,
    object,
    embed {
        position:absolute;
        top:0;
        left:0;
        width:100%;
        height:100%;
    }
}

/// Includes `@content` on screens up to `$max-width` wide.
/// @param {<number>} $max-width
@mixin max($max-width) {
    @media (max-width:$max-width) {
        @content;
    }
}

/// Includes `@content` on screens that are at least `$min-width` wide.
/// @param {<number>} $min-width
@mixin min($min-width) {
    @media (min-width:$min-width) {
        @content;
    }
}

/// @param {<number>} $min-width
/// @param {<number>} $max-width
@mixin min-max($min-width, $max-width) {
    @media (min-width:$min-width) and (max-width:$max-width) {
        @content;
    }
}

///
@mixin min-s() {
    @media (min-width:$breakpoint-s) {
        @content;
    }
}

///
@mixin min-m() {
    @media (min-width:$breakpoint-m) {
        @content;
    }
}

///
@mixin min-l() {
    @media (min-width:$breakpoint-l) {
        @content;
    }
}

///
@mixin min-xl() {
    @media (min-width:$breakpoint-xl) {
        @content;
    }
}

/// Includes `@content` for ie9 and above.
@mixin ie9plus() {
    // @formatter:off
    @media (min-width:0\0) and (min-resolution:+72dpi) {
        @content;
    }
    // @formatter:on
}

/// Includes `@content` for ie10 and above.
@mixin ie10plus() {
    @media (-ms-high-contrast:none), (-ms-high-contrast:active) {
        @content;
    }
}

/// Removes margins if element is first and/or last child (depending on scope).
/// @param {<string>} $scope [all]
@mixin control-margins($scope:all) {
    $scope-y:$scope == vertical or $scope == all;
    $scope-x:$scope == horizontal or $scope == all;

    @if $scope-y or $scope == top {
        &:first-child:not(.f-margins) {
            margin-top:0 !important;
        }
    }

    @if $scope-x or $scope == right {
        &:last-child:not(.f-margins) {
            margin-right:0 !important;
        }
    }

    @if $scope-y or $scope == bottom {
        &:last-child:not(.f-margins) {
            margin-bottom:0 !important;
        }
    }

    @if $scope-x or $scope == left {
        &:first-child:not(.f-margins) {
            margin-left:0 !important;
        }
    }
}

/// Removes bottom margins from last children.
@mixin controlled($scope:bottom) {
    * {
        @include control-margins($scope);
    }
}

/// Sets default vertical margins for selected elements
/// @param {<number>|false} $multiplier [false]
@mixin vertical-margins($multiplier:false) {
    $m:if(is-nonneg-unitless-number($multiplier), $multiplier, false);

    hr {
        margin-top:if($m, calc(var(--space) * #{$m}), var(--space));
        margin-bottom:if($m, calc(var(--space) * #{$m}), var(--space));
    }

    caption {
        margin-bottom:if($m, calc(var(--space) * .25 * #{$m}), calc(var(--space) * .25));
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        @include control-margins(top);

        margin-top:if($m, calc(var(--space-top-h) * #{$m}), var(--space-top-h));
        margin-bottom:if($m, calc(var(--space-bottom-h) * #{$m}), var(--space-bottom-h));
    }

    address,
    blockquote,
    canvas,
    dl,
    fieldset,
    figure,
    form,
    hr,
    noscript,
    ol,
    p,
    pre,
    table,
    ul,
    video {
        margin-bottom:if($m, calc(var(--space) * #{$m}), var(--space));
    }
}

/// @param {1|2|3|4} $type
/// @param {<number>|false} $margins-multiplier [false]
@mixin h($type:1, $margins-multiplier:false) {
    font-weight:var(--font-weight-heading);
    font-size:var(--font-size-h#{$type});
    font-family:var(--font-stack-heading);
    line-height:var(--line-height-h#{$type});

    @if is-nonneg-unitless-number($margins-multiplier) {
        $m:$margins-multiplier;

        @include control-margins(top);

        margin-top:if($m, calc(var(--space-top-h) * #{$m}), var(--space-top-h));
        margin-bottom:if($m, calc(var(--space-bottom-h) * #{$m}), var(--space-bottom-h));
    }
}

///
@mixin ellipsis() {
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
}

/// Removes border radius
@mixin sq() {
    border-radius:0;
}

///
@mixin hide($breakpoint:s) {
    @if index(map_keys($breakpoints), $breakpoint) {
        @include min(map_get($breakpoints, $breakpoint)) {
            display:none;
        }
    } @else if is-nonneg-unit-number($breakpoint) {
        @include min($breakpoint) {
            display:none;
        }
    }
}

/// @param {<number>|false} $multiplier [false]
/// @param {<bool>} $important [false]
@mixin mgb($multiplier:false, $important:false) {
    $m:if(is-nonneg-unitless-number($multiplier), $multiplier, false);

    @if $important == true {
        margin-bottom:if($m, calc(var(--space) * #{$m}), var(--space)) !important;
    } @else {
        margin-bottom:if($m, calc(var(--space) * #{$m}), var(--space));
    }
}

/// @param {<number>|false} $multiplier [false]
/// @param {<bool>} $important [false]
@mixin mgbch($multiplier:false, $important:false) {
    > * {
        @include mgb($multiplier, $important);
    }
}

/// @param {<number>|false} $multiplier [false]
/// @param {<bool>} $important [false]
@mixin mgb-row($multiplier:false, $important:false) {
    &:not(:last-child):after,
    &.f-margins:last-child:after {
        @include mgb($multiplier, $important);
    }
}

/// @param {<number>|false} $multiplier [false]
/// @param {<bool>} $important [false]
@mixin mgbch-row($multiplier:false, $important:false) {
    @include mgb(-$multiplier, $important);

    > * {
        @include mgb($multiplier, $important);
    }
}

/// @param {row|col} $type [row]
/// @param {<number>|false} $multiplier [false]
@mixin row-alleys($type:row, $alley-multiplier:false) {
    $m:false;

    @if index(map_keys($alley-sizes), $alley-multiplier) {
        $m:map_get($alley_sizes, $alley-multiplier);
    } @else if is-nonneg-unitless-number($alley-multiplier) {
        $m:$alley-multiplier;
    }

    @if $type == row {
        margin-right:if($m, calc(var(--alley) / 2 * #{-$m}), calc(var(--alley) / 2 * -1));
        margin-left:if($m, calc(var(--alley) / 2 * #{-$m}), calc(var(--alley) / 2 * -1));
    } @else if $type == col {
        padding-right:if($m, calc(var(--alley) / 2 * #{$m}), calc(var(--alley) / 2));
        padding-left:if($m, calc(var(--alley) / 2 * #{$m}), calc(var(--alley) / 2));
    }
}

///
@mixin row($alley-multiplier:false) {
    @include row-alleys(row, $alley-multiplier);
    @include clearfix();

    display:flex;
    flex-wrap:wrap;

    > * {
        @include row-alleys(col, $alley-multiplier);
    }
}

/// @access private
@mixin row-alley-styles($alley-multiplier) {
    @include row-alleys(row, $alley-multiplier);

    > * {
        @include row-alleys(col, $alley-multiplier);
    }
}

///
@mixin row-alley($alley-multiplier, $breakpoint:false) {
    $m:false;

    @if index(map_keys($alley-sizes), $alley-multiplier) {
        $m:map_get($alley_sizes, $alley-multiplier);
    } @else if is-nonneg-unitless-number($alley-multiplier) {
        $m:$alley-multiplier;
    }

    @if $m {
        @if index(map_keys($breakpoints), $breakpoint) {
            @include min(map_get($breakpoints, $breakpoint)) {
                @include row-alley-styles($m);
            }
        } @else if is-nonneg-unit-number($breakpoint) {
            @include min($breakpoint) {
                @include row-alley-styles($m);
            }
        } @else {
            @include row-alley-styles($m);
        }
    }
}

///
@mixin col-width($column-width, $breakpoint:false) {
    @if index(map_keys($columns), $column-width) {
        @if index(map_keys($breakpoints), $breakpoint) {
            @include min(map_get($breakpoints, $breakpoint)) {
                width:map_get($columns, $column-width);
            }
        } @else if is-nonneg-unit-number($breakpoint) {
            @include min($breakpoint) {
                width:map_get($columns, $column-width);
            }
        } @else {
            width:map_get($columns, $column-width);
        }
    } @else if is-nonneg-unitless-number($column-width) {
        @if index(map_keys($breakpoints), $breakpoint) {
            @include min(map_get($breakpoints, $breakpoint)) {
                width:percentage($column-width);
            }
        } @else if is-nonneg-unit-number($breakpoint) {
            @include min($breakpoint) {
                width:percentage($column-width);
            }
        } @else {
            width:percentage($column-width);
        }
    }
}
